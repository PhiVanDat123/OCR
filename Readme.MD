# DeepSeek OCR Pipeline - Xá»­ lÃ½ vÄƒn báº£n tiáº¿ng Viá»‡t

Pipeline xá»­ lÃ½ OCR hoÃ n chá»‰nh sá»­ dá»¥ng **DeepSeek-OCR**: **áº¢nh â†’ DeepSeek-OCR â†’ XML â†’ LLM Paraphrase â†’ XML sáº¡ch**

## ğŸš€ TÃ­nh nÄƒng má»›i vá»›i DeepSeek-OCR

- **Layout-aware OCR**: Nháº­n diá»‡n cáº¥u trÃºc vÄƒn báº£n, báº£ng, tiÃªu Ä‘á»
- **Markdown output**: Xuáº¥t trá»±c tiáº¿p sang Markdown cÃ³ cáº¥u trÃºc
- **Äa ngÃ´n ngá»¯**: Há»— trá»£ tá»‘t tiáº¿ng Viá»‡t vÃ  cÃ¡c ngÃ´n ngá»¯ khÃ¡c
- **3 cháº¿ Ä‘á»™ cháº¡y**: Local GPU, vLLM Server, Clarifai API

## ğŸ—ï¸ Kiáº¿n trÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Upload    â”‚â”€â”€â”€â”€â–¶â”‚  DeepSeek   â”‚â”€â”€â”€â”€â–¶â”‚   Text to   â”‚â”€â”€â”€â”€â–¶â”‚     LLM     â”‚
â”‚   Image     â”‚     â”‚    OCR      â”‚     â”‚     XML     â”‚     â”‚  Paraphrase â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼            â–¼            â–¼
         [Local GPU]  [vLLM Server] [Clarifai API]
```

## ğŸ“ Cáº¥u trÃºc dá»± Ã¡n

```
ocr_pipeline/
â”œâ”€â”€ backend.py          # FastAPI backend
â”œâ”€â”€ frontend.py         # Streamlit frontend
â”œâ”€â”€ ocr_module.py       # DeepSeek OCR module
â”œâ”€â”€ llm_module.py       # LLM paraphrase module
â”œâ”€â”€ config.py           # Cáº¥u hÃ¬nh
â”œâ”€â”€ requirements.txt    # Dependencies
â”œâ”€â”€ run.sh              # Script khá»Ÿi cháº¡y
â””â”€â”€ README.md           # HÆ°á»›ng dáº«n
```

## ğŸš€ CÃ i Ä‘áº·t & Cháº¡y

### 1. CÃ i Ä‘áº·t dependencies

```bash
pip install -r requirements.txt
```

### 2. CÃ i Ä‘áº·t DeepSeek-OCR

**CÃ¡ch 1: Cháº¡y Local (cáº§n GPU NVIDIA vá»›i CUDA 11.8+)**

```bash
# CÃ i Ä‘áº·t PyTorch vá»›i CUDA
pip install torch==2.6.0 torchvision --index-url https://download.pytorch.org/whl/cu118

# CÃ i flash-attention (tÃ¹y chá»n, tÄƒng tá»‘c)
pip install flash-attn==2.7.3 --no-build-isolation

# Model sáº½ tá»± Ä‘á»™ng táº£i khi cháº¡y láº§n Ä‘áº§u (~10GB)
```

**CÃ¡ch 2: DÃ¹ng vLLM Server**

```bash
# CÃ i vLLM
pip install vllm

# Cháº¡y server
vllm serve deepseek-ai/DeepSeek-OCR --port 8001

# Set environment
export DEEPSEEK_OCR_MODE=vllm
export DEEPSEEK_VLLM_URL=http://localhost:8001/v1
```

**CÃ¡ch 3: DÃ¹ng Clarifai API (khÃ´ng cáº§n GPU)**

```bash
# ÄÄƒng kÃ½ táº¡i https://clarifai.com vÃ  láº¥y PAT
export CLARIFAI_PAT=your-personal-access-token
export DEEPSEEK_OCR_MODE=api
```

### 3. Cáº¥u hÃ¬nh

```bash
# OCR Settings
export OCR_PROVIDER=deepseek        # deepseek, tesseract, mock
export DEEPSEEK_OCR_MODE=local      # local, vllm, api

# LLM Settings (cho paraphrase)
export OPENAI_API_KEY=your-key      # hoáº·c
export ANTHROPIC_API_KEY=your-key
export LLM_PROVIDER=openai          # openai, anthropic
```

### 4. Khá»Ÿi cháº¡y

```bash
# Cháº¡y script tá»± Ä‘á»™ng
chmod +x run.sh
./run.sh

# Hoáº·c cháº¡y thá»§ cÃ´ng
# Terminal 1:
python backend.py

# Terminal 2:
streamlit run frontend.py
```

### 5. Truy cáº­p

- **Frontend UI:** http://localhost:8501
- **Backend API:** http://localhost:8000
- **API Docs:** http://localhost:8000/docs

## ğŸ“– API Endpoints

### `POST /ocr`

Xá»­ lÃ½ OCR vá»›i DeepSeek-OCR.

**Request:**
- `file`: áº¢nh (multipart/form-data)
- `ocr_provider`: "deepseek" | "tesseract" | "mock" (default: deepseek)
- `ocr_mode`: "local" | "vllm" | "api" (for deepseek)
- `ocr_prompt`: Custom prompt (optional)
- `use_mock_llm`: bool (default: true)
- `llm_provider`: "openai" | "anthropic"

**Response:**
```json
{
  "raw_text": "Text trÃ­ch xuáº¥t tá»« áº£nh",
  "raw_xml": "<?xml ...>",
  "paraphrased_xml": "<?xml ...>",
  "ocr_provider": "deepseek-local",
  "success": true,
  "message": "..."
}
```

## ğŸ”§ DeepSeek OCR Prompts

```python
# Chuyá»ƒn document sang Markdown (máº·c Ä‘á»‹nh)
"<image>\n<|grounding|>Convert the document to markdown."

# OCR Ä‘Æ¡n giáº£n
"<image>\nFree OCR."

# Parse báº£ng
"<image>\n<|grounding|>Extract tables as markdown."

# Parse hÃ¬nh áº£nh/biá»ƒu Ä‘á»“
"<image>\nParse the figure."
```

## ğŸ’» YÃªu cáº§u há»‡ thá»‘ng

| Mode | GPU | RAM | VRAM |
|------|-----|-----|------|
| Local | NVIDIA CUDA 11.8+ | 32GB+ | 12GB+ |
| vLLM | NVIDIA CUDA 11.8+ | 32GB+ | 24GB+ |
| Clarifai API | KhÃ´ng cáº§n | 8GB | - |

## ğŸ› Troubleshooting

**Lá»—i "CUDA out of memory":**
- Giáº£m kÃ­ch thÆ°á»›c áº£nh trÆ°á»›c khi upload
- DÃ¹ng mode `api` (Clarifai) thay vÃ¬ `local`

**Lá»—i "Model loading failed":**
- Kiá»ƒm tra káº¿t ná»‘i internet (model ~10GB)
- Äáº£m báº£o Ä‘á»§ dung lÆ°á»£ng á»• cá»©ng

**Lá»—i Clarifai API:**
- Kiá»ƒm tra CLARIFAI_PAT Ä‘Ã£ set Ä‘Ãºng
- Kiá»ƒm tra quota API cÃ²n khÃ´ng

## ğŸ“„ License

MIT License