# DeepSeek OCR Pipeline - API Only Mode

Pipeline xá»­ lÃ½ OCR hoÃ n chá»‰nh sá»­ dá»¥ng **DeepSeek-OCR qua API**: **áº¢nh â†’ DeepSeek-OCR (API) â†’ XML â†’ LLM Paraphrase â†’ XML sáº¡ch**

## ğŸš€ TÃ­nh nÄƒng

- **KhÃ´ng cáº§n GPU**: Sá»­ dá»¥ng API thay vÃ¬ cháº¡y model local
- **Chi phÃ­ tháº¥p**: Replicate ~$0.011/láº§n cháº¡y (~90 láº§n/$1)
- **Layout-aware OCR**: Nháº­n diá»‡n cáº¥u trÃºc vÄƒn báº£n, báº£ng, tiÃªu Ä‘á»
- **Markdown output**: Xuáº¥t trá»±c tiáº¿p sang Markdown cÃ³ cáº¥u trÃºc
- **Äa ngÃ´n ngá»¯**: Há»— trá»£ tá»‘t tiáº¿ng Viá»‡t vÃ  ~100 ngÃ´n ngá»¯ khÃ¡c

## ğŸ—ï¸ Kiáº¿n trÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Upload    â”‚â”€â”€â”€â”€â–¶â”‚  DeepSeek-OCR   â”‚â”€â”€â”€â”€â–¶â”‚   Text to   â”‚â”€â”€â”€â”€â–¶â”‚     LLM     â”‚
â”‚   Image     â”‚     â”‚   (API)         â”‚     â”‚     XML     â”‚     â”‚  Paraphrase â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                         â–¼
         [Replicate]              [Clarifai]
         ~$0.011/run              Free tier
```

## ğŸ“ Cáº¥u trÃºc dá»± Ã¡n

```
ocr_pipeline/
â”œâ”€â”€ backend.py          # FastAPI backend
â”œâ”€â”€ frontend.py         # Streamlit frontend
â”œâ”€â”€ ocr_module.py       # DeepSeek OCR module (API only)
â”œâ”€â”€ llm_module.py       # LLM paraphrase module
â”œâ”€â”€ config.py           # Cáº¥u hÃ¬nh
â”œâ”€â”€ requirements.txt    # Dependencies
â””â”€â”€ README.md           # HÆ°á»›ng dáº«n
```

## ğŸ”‘ Láº¥y API Keys

### Option 1: Replicate API (KhuyÃªn dÃ¹ng - ~$0.011/láº§n cháº¡y)

1. ÄÄƒng kÃ½ táº¡i [replicate.com](https://replicate.com)
2. VÃ o [Account API Tokens](https://replicate.com/account/api-tokens)
3. Táº¡o token má»›i
4. Set environment variable:
```bash
export REPLICATE_API_TOKEN=r8_xxxxxxxxxxxxxxxxxxxx
```

**Pricing**: ~$0.011/láº§n cháº¡y = ~90 láº§n OCR vá»›i $1

### Option 2: Clarifai API (CÃ³ Free Tier)

1. ÄÄƒng kÃ½ táº¡i [clarifai.com](https://clarifai.com)
2. VÃ o [Security Settings](https://clarifai.com/settings/security)
3. Táº¡o Personal Access Token (PAT)
4. Set environment variable:
```bash
export CLARIFAI_PAT=your-personal-access-token
```

**Pricing**: Free tier cÃ³ giá»›i háº¡n, sau Ä‘Ã³ tÃ­nh phÃ­

## ğŸš€ CÃ i Ä‘áº·t & Cháº¡y

### 1. CÃ i Ä‘áº·t dependencies

```bash
pip install -r requirements.txt
```

### 2. Cáº¥u hÃ¬nh API Keys

```bash
# OCR API (chá»n 1 trong 2)
export REPLICATE_API_TOKEN=your-replicate-token     # KhuyÃªn dÃ¹ng
# hoáº·c
export CLARIFAI_PAT=your-clarifai-pat

# OCR Provider máº·c Ä‘á»‹nh
export OCR_PROVIDER=replicate    # replicate, clarifai, hoáº·c mock

# LLM Settings (cho paraphrase - tÃ¹y chá»n)
export OPENAI_API_KEY=your-openai-key
# hoáº·c
export ANTHROPIC_API_KEY=your-anthropic-key
export LLM_PROVIDER=openai      # openai hoáº·c anthropic
```

### 3. Khá»Ÿi cháº¡y

```bash
# Terminal 1: Backend
python backend.py

# Terminal 2: Frontend
streamlit run frontend.py
```

### 4. Truy cáº­p

- **Frontend UI:** http://localhost:8501
- **Backend API:** http://localhost:8000
- **API Docs:** http://localhost:8000/docs

## ğŸ“– API Endpoints

### `POST /ocr`

Xá»­ lÃ½ OCR vá»›i DeepSeek-OCR qua API.

**Request:**
- `file`: áº¢nh (multipart/form-data)
- `ocr_provider`: "replicate" | "clarifai" | "mock" (default: replicate)
- `ocr_prompt`: Custom prompt (optional)
- `use_mock_llm`: bool (default: true)
- `llm_provider`: "openai" | "anthropic"

**Response:**
```json
{
  "raw_text": "Text trÃ­ch xuáº¥t tá»« áº£nh",
  "raw_xml": "<?xml ...>",
  "paraphrased_xml": "<?xml ...>",
  "ocr_provider": "replicate",
  "success": true,
  "message": "..."
}
```

### `GET /config`

Kiá»ƒm tra cáº¥u hÃ¬nh hiá»‡n táº¡i.

**Response:**
```json
{
  "ocr_provider": "replicate",
  "replicate_configured": true,
  "clarifai_configured": false,
  "openai_configured": true,
  "anthropic_configured": false
}
```

## ğŸ”§ OCR Prompts

DeepSeek-OCR há»— trá»£ nhiá»u loáº¡i prompt khÃ¡c nhau:

```python
# Chuyá»ƒn document sang Markdown (máº·c Ä‘á»‹nh)
"Convert the document to markdown."

# OCR Ä‘Æ¡n giáº£n
"Free OCR."

# Parse báº£ng
"Extract tables as markdown."

# Parse hÃ¬nh áº£nh/biá»ƒu Ä‘á»“
"Parse the figure."

# TrÃ­ch xuáº¥t text
"Extract the text in the image."
```

## ğŸ’° So sÃ¡nh chi phÃ­

| Provider | GiÃ¡ | Ghi chÃº |
|----------|-----|---------|
| Replicate | ~$0.011/run | KhuyÃªn dÃ¹ng, á»•n Ä‘á»‹nh |
| Clarifai | Free tier | Giá»›i háº¡n requests |
| Local GPU | $0 (cÃ³ GPU) | Cáº§n NVIDIA GPU 12GB+ VRAM |

## ğŸ’» YÃªu cáº§u há»‡ thá»‘ng

- Python 3.8+
- Internet connection (Ä‘á»ƒ gá»i API)
- **KhÃ´ng cáº§n GPU**

## ğŸ› Troubleshooting

**Lá»—i "REPLICATE_API_TOKEN not configured":**
```bash
export REPLICATE_API_TOKEN=your-token
```

**Lá»—i "CLARIFAI_PAT not configured":**
```bash
export CLARIFAI_PAT=your-token
```

**Lá»—i timeout:**
- Kiá»ƒm tra káº¿t ná»‘i internet
- Thá»­ láº¡i vá»›i áº£nh nhá» hÆ¡n

**Test vá»›i mock mode:**
```bash
export OCR_PROVIDER=mock
```

## ğŸ“„ License

MIT License